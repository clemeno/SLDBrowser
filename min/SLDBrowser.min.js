/*! SLDBrowser : Semantic Linked Data Browser - v0.1.0 - 2014-06-17
* http://pirmil.eu
* Copyright (c) 2014 Clément Ménoret ;
 Licensed SLDBrowser : Semantic Linked Data Browser
Copyright (C) 2014 Clement Menoret

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. */
function parseDate(a,b){for(var c=a.trim()||"",d=b.trim()||"",e=0,f=0,g=c.length,h=d.length,i=["0","1","2","3","4","5","6","7","8","9"],j=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],k=["","January","February","March","April","May","June","July","August","September","October","November","December"],l="",m="",n="",o="",p="",q="",r=!1;g>f&&h>e;){if(i.hasValue(c[f])){var s=c[f].toString(),t=d[e].toString();r=!0,"Y"==t?l+=s:"M"==t?m+=s:"D"==t?n+=s:"H"==t?o+=s:"I"==t?p+=s:"S"==t&&(q+=s)}else r&&(r=!1,e+=1);f+=1}for(;l.length<4;)l="0"+l;for(;m.length<2;)m="0"+m;for(;n.length<2;)n="0"+n;for(;o.length<2;)o="0"+o;for(;p.length<2;)p="0"+p;for(;q.length<2;)q="0"+q;return{fullyear:l||"0000",year:parseInt(l,10)||0,fullmonth:m||"00",month:parseInt(m,10)||0,monthtext:j[(parseInt(m,10)<13?parseInt(m,10):0)||0],fullmonthtext:k[(parseInt(m,10)<13?parseInt(m,10):0)||0],fullday:n||"00",day:parseInt(n,10)||0,fullhour:o||"00",hour:parseInt(o,10)||0,fullminute:p||"00",minute:parseInt(p,10)||0,fullsecond:q||"00",second:parseInt(q,10)||0}}function insertAfter(a,b){a.parentNode.insertBefore(b,a.nextSibling)}function getCleanTopbarEndpoint(){return $("#defaultendpoint").val().trim()}function getCleanTopbarUri(){return $("#defaultentryuri").val().trim()}function setCleanTopbarUri(a){$("#defaultentryuri").val(a.trim())}function toggleBigImage1(a){$(a).toggleClass("bigimg1")}function nodetogglecontent(a,b){"-"==$(a).html()?($(a).html("+"),$("#"+b+"	.hideable").hide()):($(a).html("-"),$("#"+b+"	.hideable").fadeIn())}function displayPageLoading(){$("#loading").html(img_loading_dark_32)}function displayPageLoaded(){$("#loading").html(img_valid_32)}function displayPageError(){$("#loading").html(img_wrong_32)}function displayPageImageLoading(){$("#loading").html(img_images_32)}function clearbrowser_click(){$("#webappcontrol").html(""),$(hashtagworkspaceid).html(""),rebuilddefaultworkspace(),ITS=new InternalTripleStore,objectids=[],nextobjectid=0,nextmapid=0,nexttimelineid=0,nextsuggestionseditorid=0,objectid_to_uri=new Mapping,object_has_expanded_predicates={},suggestionsFor=new Mapping}function startbrowsing_click(){displayPageLoading();var a=$("#langselector").val(),b=[getCleanTopbarEndpoint(),"select distinct ?p ?o where { <"+getCleanTopbarUri()+"> ?p ?o }"],c=null,d=null,e=[],f=null,g=[],h=[],i="",j="",k="",l="",m="",n="",o="http://www.w3.org/2000/01/rdf-schema#label",p="",q="http://www.w3.org/2000/01/rdf-schema#comment",r="",s="http://xmlns.com/foaf/0.1/depiction",t="",u="",v="",w=!1,x="",y=!1,z=!1,A=!1,B=[];c=$.ajax({type:"POST",url:b[0],data:"query="+encodeURIComponent(b[1]),async:!1}).responseText,window.DOMParser?d=(new DOMParser).parseFromString(c,"text/xml"):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async=!1,d.loadXML(c)),e=d.getElementsByTagName("result");for(var C=0;C<e.length;C++)if(f=e[C],"uri"==f.childNodes[1].childNodes[0].tagName&&(i=f.childNodes[1].childNodes[0].childNodes[0].nodeValue||"",g.hasValue(i)||(g.push(i),h[i]=[])),"uri"==f.childNodes[3].childNodes[0].tagName){try{j=f.childNodes[3].childNodes[0].childNodes[0].nodeValue||""}catch(D){j=""}h[i].push(["uri",j,!1,!1])}else if("literal"==f.childNodes[3].childNodes[0].tagName){try{j=f.childNodes[3].childNodes[0].childNodes[0].nodeValue||""}catch(D){j=""}k=f.childNodes[3].childNodes[0].getAttribute("lang"),l=f.childNodes[3].childNodes[0].getAttribute("xml:lang"),m=f.childNodes[3].childNodes[0].getAttribute("datatype"),h[i].push(k?["literal",j,"lang",k]:l?["literal",j,"xml:lang",l]:m?["literal",j,"datatype",m]:["literal",j,!1,!1])}g.forEach(function(b){h[b].forEach(function(c){(c[3]==a||"uri"==c[0]||"en"==a&&"literal"==c[0]&&!c[3])&&(b==o?(n+='<span	class="selectable">'+c[1]+'</span><div	class="ib">'+("en"==a?"":"&nbsp;("+a+")")+"</div>",w=new Triple(getCleanTopbarUri(),o,c[1])):b==q?(p+='<span	class="selectable">'+c[1]+"</span>",w=new Triple(getCleanTopbarUri(),q,c[1])):b==s&&(r+='<img	src="'+c[1]+'"	title="&nbsp;"	alt="&nbsp;"	onclick="toggleBigImage1(this)"	/>',w=new Triple(getCleanTopbarUri(),s,c[1])),w&&ITS.addTriple(w))})}),x="objectid"+nextobjectid,y=$('<div	class="item	object"	id="'+x+'"><div	class="hiddeninputssources"><input	type="hidden"	name="uri"	value="'+getCleanTopbarEndpoint()+'"	/></div><button	onclick="idontneedtoknowabout(\''+x+"')\">X</button><button	onclick=\"nodetogglecontent(this,'"+x+'\')">-</button><h4	class="rdfs	label">'+n+'	</h4><p	class="rdfs	comment	hideable">'+r+p+'</p><div	class="ib	hideable"><button	onclick="seerefendpoints(this,\''+x+"','"+getCleanTopbarUri()+'\')">See	endpoints...</button><ul	class="refendpointslist">'+u+'</ul></div><div	class="ib	hideable"><button	onclick="seerefuris(this,\''+x+"','"+getCleanTopbarUri()+'\')">See	URIs...</button><ul	class="refurislist">'+v+'</ul></div><div	class="ib	hideable"><button	onclick="seeotherpredicates(this,\''+x+"','"+getCleanTopbarUri()+'\')">See	other	predicates...</button><ul	class="predicatelist">'+t+"</ul></div></div>"),z=y[0],A=document.createDocumentFragment(),A.appendChild(z),webappfullcontainer.insertBefore(A,webappfullcontainer.firstChild),B.push(z),msnry.prepended(B),objectid_to_uri[x]=new Array(getCleanTopbarUri()),nextobjectid+=1,object_has_expanded_predicates[x]=!1,actionhistory.push(["added","entrypoint",x]),actionhistory_pointer+=1,displayPageImageLoading(),imagesLoaded(document.querySelector(hashtagworkspaceid),function(){msnry.layout(),$("#"+x).draggable({containment:"parent",opacity:.5,cancel:".selectable"}),displayPageLoaded()})}function seerefendpoints(a,b){displayPageLoading(),$(a).hide().remove();var c=[],d="",e="";$("#"+b+"	.hiddeninputssources	input").each(function(){e=$(this).val(),c.hasValue(e)||(c.push(e),d+='<li><span class="selectable">'+e+"</span></li>")}),$("#"+b+" .refendpointslist").html("<h5>Reference endpoints</h5>"),$(d).hide().appendTo("#"+b+" .refendpointslist").fadeIn(),displayPageLoaded()}function seerefuris(a,b){displayPageLoading(),$(a).hide().remove();var c="";objectid_to_uri[b].forEach(function(a){c+='<li><span class="selectable	uri">'+a+"</span></li>"}),$("#"+b+" .refurislist").html("<h5>Reference URIs</h5>"),$(c).hide().appendTo("#"+b+" .refurislist").fadeIn(),displayPageLoaded()}function spawnnode(a){a&&setCleanTopbarUri(a),startbrowsing_click()}function removeitem(a){msnry.remove($("#"+a)[0]),msnry.layout()}function idontneedtoknowabout(a,b,c,d,e){displayPageLoading(),objectid_to_uri[a].forEach(function(f){var g=new Triple,h="( ";if(f&&(g.s=f,h+=g.s),b&&(g.p=b,h+=", "+g.p),d&&(g.o=d,h+=", "+g.o),h+=" )",confirm("Forget about "+h+" ?")&&0===ITS.removeTriple(g).length){if(e&&c&&a)$("#"+a+" ."+c+" ."+e).hide().remove();else if(c&&a)$("#"+a+" ."+c).hide().remove();else if(a)try{delete suggestionsFor[a]}catch(i){}finally{msnry.remove($("#"+a)[0])}msnry.layout()}}),displayPageLoaded()}function seeotherpredicates(a,b,c){displayPageLoading();var d=[getCleanTopbarEndpoint(),"select distinct ?p where { <"+c+"> ?p ?o }"],e="",f=[],g=[],h="",i="",j=0;e=$.ajax({type:"POST",url:d[0],data:"query="+encodeURIComponent(d[1]),async:!1}).responseText,window.DOMParser?xmlDoc=(new DOMParser).parseFromString(e,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(e)),f=xmlDoc.getElementsByTagName("result"),j=0;for(var k=0;k<f.length;k++)"uri"==f[k].childNodes[1].childNodes[0].tagName&&(h=f[k].childNodes[1].childNodes[0].childNodes[0].nodeValue||"",g.hasValue(h)||(g.push(h),i+='<li><span	class="selectable	uri">'+h+'</span><img	class="nodespawner"	src="img/expandtree001.gif"	alt=""	title=""width="9px"	height="9px"	onclick="spawnnode(\''+h+"');\"	/> <div><button	onclick=\"seeobjectshere(this,'"+b+"','"+h+"',"+j+')">See	objects...</button><button	onclick="idontneedtoknowabout(\''+b+"','"+h+"','predicate"+j+'\')">X</button></div><ul	class="objectlist	predicate'+j+'"></ul></li>',j+=1));$(a).hide().remove(),$("#"+b+" .predicatelist").html("<h5>Known predicates</h5>"),$(i).hide().appendTo("#"+b+" .predicatelist").fadeIn(),object_has_expanded_predicates[b]=!0,displayPageLoaded()}function seeobjectshere(a,b,c,d){displayPageLoading(),$(a).hide().remove();var e=[],f=[],g=[],h=null,i="",j=[],k="",l="",m=!1,n=!1,o=!1,p=new Triple,q=new Triple,r="",s=0;$("#"+b+" .hiddeninputssources input").each(function(){e.push($(this).val())}),e.forEach(function(a){objectid_to_uri[b].forEach(function(e){h=[a,"select distinct ?o where {  <"+e+"> <"+c+"> ?o }"],i=$.ajax({type:"POST",url:h[0],data:"query="+encodeURIComponent(h[1]),async:!1}).responseText,window.DOMParser?xmlDoc=(new DOMParser).parseFromString(i,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(i)),j=xmlDoc.getElementsByTagName("result"),s=0;for(var t=0;t<j.length;t++)"uri"==j[t].childNodes[1].childNodes[0].tagName?(k=j[t].childNodes[1].childNodes[0].childNodes[0].nodeValue||"",f.hasValue(k)||(f.push(k),r+='<li	class="object'+s+'"><span	class="selectable	relobject	uri">'+k+'</span><img	class="nodespawner"	src="img/expandtree001.gif"	alt=""	title=""width="9px"	height="9px"	onclick="spawnnode(\''+k+"');\"	/><button	onclick=\"idontneedtoknowabout('"+b+"','"+c+"','predicate"+d+"','"+k+"','object"+s+"')\">X</button></li>",s+=1)):(k=j[t].childNodes[1].childNodes[0].childNodes[0].nodeValue||"",g.hasValue(k)||(g.push(k),r+='<li	class="object'+s+'"><span	class="selectable	relobject	literal">'+k+"</span><button	onclick=\"idontneedtoknowabout('"+b+"','"+c+"','predicate"+d+"','"+k+"','object"+s+"')\">X</button></li>",s+=1)),suggestionsFor.hasOwnProperty(b)||(suggestionsFor[b]=[]),p=new Triple(e,c,k),ITS.addTriple(p),l="map",suggestionsFor[b].some(function(a){return a===l})||(knownPredicates.geo.longitude.forEach(function(a){a.forEach(function(a){q.s=p.s,n=ITS.getTriplesMatching(q).some(function(b){return b.p.indexOf(a)>-1})})}),knownPredicates.geo.latitude.forEach(function(a){a.forEach(function(a){q.s=p.s,o=ITS.getTriplesMatching(q).some(function(b){return b.p.indexOf(a)>-1})})})),l="timeline",suggestionsFor[b].some(function(a){return a===l})||knownPredicates.date.forEach(function(a){a.forEach(function(a){a.forEach(function(a){q.s=p.s,m=ITS.getTriplesMatching(q).some(function(b){return b.p.indexOf(a)>-1})})})});n&&o&&(suggestionsFor[b].push("map"),alert("It seems that this concept can be visualised on a map. ")),m&&(suggestionsFor[b].push("timeline"),alert("It seems that this concept can be visualised on a timeline. "))})}),$(r).hide().appendTo("#"+b+" .predicatelist .predicate"+d).fadeIn(),displayPageLoaded()}function rebuildlayout(){msnry.layout()}function rebuildsafeworkspacewithdata(){var a=url_data.GET("endpoint",null),b=url_data.GET("uri",null),c=url_data.GET("lang",null);rebuilddefaultworkspace(a,b,c)}function rebuilddefaultworkspace(a,b,c){$('	<div	class="topdiv"><p><span	id="webapptitle"><span	id="loading">(Please enable Javascript)</span>	Semantic Linked Data Browser (dev)</span> SLDBrowser  Copyright (C) 2014  Clément Ménoret under GPLv3 license http://www.gnu.org/licenses/gpl-3.0.html<div>Internal representation <button	id="testbutton1"	title="InternalTripleStore state"	onclick="testbutton1()">Current knowledge</button><button	id="testbutton3"	title="Visualisation suggestions state"	onclick="testbutton3()">Current suggestions</button><button	id="testbutton2"	title="Suggestions about predicates visualisation"	onclick="testbutton2()">Suggestions tree</button><button	id="testbutton4"	title="Edit suggestions about predicates visualisation"	onclick="testbutton4()">Edit suggestions</button></div></p><div	id="nav"><label	for="defaultendpoint">Endpoint </label><input	id="defaultendpoint"	value="http://fr.dbpedia.org/sparql"	/><label	for="defaultentryuri"> URI	&lt; </label><input	id="defaultentryuri"	value="http://fr.dbpedia.org/resource/Al_Pacino"	/><label	for="defaultentryuri"> &gt; </label><select	id="langselector"><optgroup	label="Popular"><option	value="en"	selected	>(en)	English	(default)</	option><option	value="ja"						>(ja)	日本語</							option><option	value="fr"						>(fr)	Français</					option><option	value="es"						>(es)	Español</						option><option	value="de"						>(de)	Deutsch</						option><option	value="it"						>(it)	Italiano</					option><option	value="zh"						>(zh)	中文</								option></optgroup><optgroup	label="(a-z) Sorted"><option	value="az"			>(az) Azərbaycanca</				option><option	value="bg"			>(bg) Български</						option><option	value="br"			>(br) Brezhoneg</						option><option	value="ca"			>(ca) Català</							option><option	value="cs"			>(cs) Čeština</							option><option	value="da"			>(da) Dansk</								option><option	value="de"			>(de) Deutsch</							option><option	value="en"			>(en) English (default)</		option><option	value="es"			>(es) Español</							option><option	value="et"			>(et) Eesti</								option><option	value="eo"			>(eo) Esperanto</						option><option	value="eu"			>(eu) Euskara</							option><option	value="fa"			>(fa) فارسی</							option><option	value="fr"			>(fr) Français</						option><option	value="ko"			>(ko) 한국어</								option><option	value="id"			>(id) Bahasa Indonesia</		option><option	value="is"			>(is) Íslenska</						option><option	value="it"			>(it) Italiano</						option><option	value="ja"			>(ja) 日本語</								option><option	value="la"			>(la) Latina</							option><option	value="nl"			>(nl) Nederlands</					option><option	value="no"			>(no) Norsk	bokmål</				option><option	value="pl"			>(pl) Polski</							option><option	value="pt"			>(pt) Português</						option><option	value="qu"			>(qu) Runa Simi</						option><option	value="ru"			>(ru) Русский</							option><option	value="simple"	>(simple) Simple English</	option><option	value="sr"			>(sr) Српски / srpski</			option><option	value="fi"			>(fi) Suomi</								option><option	value="sv"			>(sv) Svenska</							option><option	value="tl"			>(tl) Tagalog</							option><option	value="tr"			>(tr) Türkçe</							option><option	value="uk"			>(uk) Українська</					option><option	value="vi"			>(vi) Tiếng Việt</					option><option	value="zh"			>(zh) 中文</									option><option	value="zh-yue"	>(zh-yue) 粵語</							option></optgroup></select><button	id="startbrowsing"	title="Start browsing from the URI"	onclick="startbrowsing_click()">►</button><button	id="clearbrowser"	title="Reset the browser"	onclick="clearbrowser_click()">￭</button></div><div>Layout <button	id="rebuildlayout"	title="Reorganise layout"	onclick="rebuildlayout()">⌗</button> &bull; Visualisation <button	id="testbuttonM"	title="Map visualisation"	onclick="testbuttonM()">Map</button><button	id="testbuttonT"	title="Timeline visualisation"	onclick="testbuttonT()">Timeline</button></div>').hide().appendTo("#webappcontrol").fadeIn(1e3);try{if(null!=a&&!function(){var b=getCleanTopbarEndpoint();try{$("#defaultendpoint").val(a)}catch(c){$("#defaultendpoint").val(b)}}(),null!=b&&!function(){var a=getCleanTopbarUri();try{$("#defaultentryuri").val(b)}catch(c){$("#defaultentryuri").val(a)}}(),null!=c)try{$("#langselector option[selected]").removeAttr("selected")}finally{try{$("#langselector").val(c),$('#langselector option[value="'+c+'"]').attr("selected",!0)}catch(d){$("#langselector").val("en"),$('#langselector option[value="en"]').attr("selected",!0)}}else $('#langselector optgroup[label="Popular"] option[value="en"]').attr("selected",!0)}finally{$("#spacetop").css("height",function(){return 24+$("#webappcontrol").height()+"px"}),(null!=a||null!=b||null!=c)&&startbrowsing_click()}displayPageLoaded()}function testbutton1(){alert("Number of known Triples = "+ITS.countTriplesMatching(new Triple)+"\n"+ITS.getAllTriples().join("\n"))}function testbutton2(){var a="";knownPredicates.forEach(function(b,c){a+=c+"	{\n",b.forEach(function(b,c){a+="	"+c+"	{\n",b.forEach(function(b,c){a+="		"+c+"	{\n",b.forEach(function(b){a+='			"'+b+'"\n'}),a+="		}\n"}),a+="	}\n"}),a+="}\n"}),alert(a)}function testbutton3(){var a="";suggestionsFor.forEach(function(b,c){a+="Candidate: "+c+"\n",a+="Suggestions for "+c+" : { "+b.join(", ")+" } \n"}),""===a&&(a+="No visualisation suggesion. "),alert(a)}function testbutton4(){if(displayPageLoading(),0===nextsuggestionseditorid){var a=[],b=null,c=null,d=null,e="",f="";b=$('<div	class="item	timeline"	id="suggestionseditoritem'+nextsuggestionseditorid+'"><button	onclick="removeitem(\'suggestionseditoritem'+nextsuggestionseditorid+"');nextsuggestionseditorid	-=	1;\">X</button> <button	onclick=\"nodetogglecontent(this,'suggestionseditoritem"+nextsuggestionseditorid+'\')">-</button> <h2	style="display:inline;">Suggestions editor</h2><div	class="canevas	hideable"	id="suggestionseditor'+nextsuggestionseditorid+'"></div></div>'),c=b[0],d=document.createDocumentFragment(),d.appendChild(c),webappfullcontainer.insertBefore(d,webappfullcontainer.firstChild),a.push(c),msnry.prepended(a),$('<div	class="suggestionseditorcontent"><div	class="section detectioneditor"><h3>Detection editor</h3><div><table	id="detectionvisualisatontable'+nextsuggestionseditorid+'"><tr><th	class="a"	>category</				th><th	class="b"	>format</					th><th	class="c"	>specification</	th><th	class="d"	>uri</						th><th	class="x"	></								th></tr><table></div><span	class="interaction"><input	type="text"	id="adetectioninput"								></input><input	type="text"	id="bdetectioninput"								></input><input	type="text"	id="cdetectioninput"								></input><input	type="text"	id="uridetectioninput"	class="uri"	></input><button	id="updatedetectiontree"	onclick="updatedetectiontree_click('+nextsuggestionseditorid+')">Update</button></span></div><div	class="section	detectionvisualisationeditor"><h3>Detection-visualisation matching editor</h3><div><table	id="detectionvisualisatontable'+nextsuggestionseditorid+'"><tr><th	class="y"	>Detection</			th><th	class="z"	>Visualisation</	th><th	class="x"	></								th></tr><tr>	<td	>geo</				td>	<td	>map</						td>	<td	><button	disabled>X</button></	td>	</tr><tr>	<td	>date</				td>	<td	>timeline</				td>	<td	><button	disabled>X</button></	td>	</tr><table></div><span	class="interaction"><select	id="detectionselector'+nextsuggestionseditorid+'"></select><select	id="visualisationselector'+nextsuggestionseditorid+'"><option	value="map"				>map</			option><option	value="timeline"	>timeline</	option></select><button	id="updatedetectionvisualisaton"	disabled>Update</button></span></div></div>').hide().appendTo("#suggestionseditor"+nextsuggestionseditorid).fadeIn(),knownPredicates.forEach(function(a,b){a.forEach(function(a,c){a.forEach(function(a,d){a.forEach(function(a){f+="<tr><td>"+b+"</td><td>"+c+"</td><td>"+d+"</td><td>"+a+'</td><td><button	onclick="removedetectiontree_click(this,'+nextsuggestionseditorid+')">X</button></td></tr>'})})})}),$(f).hide().appendTo("#detectionvisualisatontable"+nextsuggestionseditorid).fadeIn(),knownPredicates.forEach(function(a,b){e+='<option	value="'+b+'">'+b+"</option>",a.forEach(function(a,c){e+='<option	value="'+b+"."+c+'">'+b+"."+c+"</option>",a.forEach(function(a,d){e+='<option	value="'+b+"."+c+"."+d+'">'+b+"."+c+"."+d+"</option>",a.forEach(function(a){e+='<option	value="'+b+"."+c+"."+d+"#"+a+'">'+b+"."+c+"."+d+"#"+a+"</option>"})})})}),$(e).hide().appendTo("#detectionselector"+nextsuggestionseditorid).fadeIn(),$("#suggestionseditoritem"+nextsuggestionseditorid).draggable({containment:"parent",opacity:.5,cancel:".interaction"}),nextsuggestionseditorid+=1,msnry.layout()}displayPageLoaded()}function removedetectiontree_click(a,b){var c=$(a).parent().parent(),d=c.find("td:nth-child(1)").html().trim()||"",e=c.find("td:nth-child(2)").html().trim()||"",f=c.find("td:nth-child(3)").html().trim()||"",g=c.find("td:nth-child(4)").html().trim()||"",h=knownPredicates[d][e][f].indexOf(g),i="";h>-1&&knownPredicates[d][e][f].splice(h,1),knownPredicates[d][e][f].length<1&&delete knownPredicates[d][e][f],knownPredicates[d][e].count()<1&&delete knownPredicates[d][e],knownPredicates[d].count()<1&&delete knownPredicates[d],c.hide().remove(),$("#detectionselector"+b+" option").hide().remove(),knownPredicates.forEach(function(a,b){i+='<option	value="'+b+'">'+b+"</option>",a.forEach(function(a,c){i+='<option	value="'+b+"."+c+'">'+b+"."+c+"</option>",a.forEach(function(a,d){i+='<option	value="'+b+"."+c+"."+d+'">'+b+"."+c+"."+d+"</option>",a.forEach(function(a){i+='<option	value="'+b+"."+c+"."+d+"#"+a+'">'+b+"."+c+"."+d+"#"+a+"</option>"})})})}),$(i).hide().appendTo("#detectionselector"+b).fadeIn()}function addindetectiontable(a,b,c,d,e){var f="";$("<tr><td>"+a+"</td><td>"+b+"</td><td>"+c+"</td><td>"+d+'</td><td><button	onclick="removedetectiontree_click(this,'+e+')">X</button></td></tr>').hide().appendTo("#detectionvisualisatontable"+e).fadeIn(),$("#detectionselector"+e+" option").hide().remove(),knownPredicates.forEach(function(a,b){f+='<option	value="'+b+'">'+b+"</option>",a.forEach(function(a,c){f+='<option	value="'+b+"."+c+'">'+b+"."+c+"</option>",a.forEach(function(a,d){f+='<option	value="'+b+"."+c+"."+d+'">'+b+"."+c+"."+d+"</option>",a.forEach(function(a){f+='<option	value="'+b+"."+c+"."+d+"#"+a+'">'+b+"."+c+"."+d+"#"+a+"</option>"})})})}),$(f).hide().appendTo("#detectionselector"+e).fadeIn()}function updatedetectiontree_click(a){displayPageLoading();var b=$("#suggestionseditor"+a+" #adetectioninput").val().trim()||"",c=$("#suggestionseditor"+a+" #bdetectioninput").val().trim()||"",d=$("#suggestionseditor"+a+" #cdetectioninput").val().trim()||"",e=$("#suggestionseditor"+a+" #uridetectioninput").val().trim()||"";""!==e&&(knownPredicates[b]||(knownPredicates[b]=new Mapping),knownPredicates[b][c]||(knownPredicates[b][c]=new Mapping),knownPredicates[b][c][d]||(knownPredicates[b][c][d]=[]),knownPredicates[b][c][d].hasValue(e)?alert("Detection already active"):(knownPredicates[b][c][d].push(e),addindetectiontable(b,c,d,e,a))),displayPageLoaded()}function testbuttonM(){displayPageLoading();var a=[],b=null,c=null,d=null,e=null;b=$('<div	class="item	map"	id="mapitem'+nextmapid+'"><button	onclick="removeitem(\'mapitem'+nextmapid+"')\">X</button><button	onclick=\"nodetogglecontent(this,'mapitem"+nextmapid+'\')">-</button>	Visualisation:	map	|	<span	class="timestamp">'+(new Date).toLocaleDateString()+"&nbsp;"+(new Date).toLocaleTimeString()+'</span><div	class="canevas	hideable"	id="map'+nextmapid+'"></div></div>'),c=b[0],d=document.createDocumentFragment(),d.appendChild(c),webappfullcontainer.insertBefore(d,webappfullcontainer.firstChild),a.push(c),msnry.prepended(a),e=new OpenLayers.Map({div:"map"+nextmapid,projection:"EPSG:900913",layers:[new OpenLayers.Layer.OSM],center:[0,0],numZoomLevels:22,zoom:1}),function(){var a=new OpenLayers.Layer.Markers("Markers"),b=new OpenLayers.Size(21,25),c=new OpenLayers.Pixel(-(b.w/2),-b.h),d=new OpenLayers.Icon("http://www.openlayers.org/dev/img/marker.png",b,c),f=!0,g=OpenLayers.Layer.Vector.prototype.renderers,h=new OpenLayers.Layer.Vector("Simple	Geometry",{styleMap:new OpenLayers.StyleMap({"default":{strokeColor:"#000000",strokeOpacity:.4,strokeWidth:1,fillColor:"#FFFFFF",fillOpacity:.2,pointRadius:6,pointerEvents:"visiblePainted",label:"${rdflabeltext}",fontColor:"${favColor}",fontSize:"14px",fontFamily:"sans-serif",fontWeight:"100",labelAlign:"${align}",labelXOffset:"${xOffset}",labelYOffset:"${yOffset}",labelOutlineColor:"rgba(	0,	0,	0,	0.9	)",labelOutlineWidth:4}}),renderers:g}),i=new Mapping;i.wgs84=new OpenLayers.Projection("EPSG:4326"),i.mercator=new OpenLayers.Projection("EPSG:900913"),e.addLayer(a),e.addLayer(h),suggestionsFor.forEach(function(b,c){if(b.hasValue("map")){var g=new Mapping,j=new Mapping,k=[];objectid_to_uri[c].forEach(function(a){ITS.getTriplesMatching(new Triple(a,"http://www.w3.org/2000/01/rdf-schema#label",void 0)).forEach(function(a){k.hasValue(a.o)||k.push(a.o)})}),objectid_to_uri[c].forEach(function(b){knownPredicates.geo.longitude.forEach(function(a,c){g[c]||(g[c]=[]),a.forEach(function(a){g[c]=g[c].concat(ITS.getTriplesMatching(new Triple(b,a,void 0)))})}),knownPredicates.geo.latitude.forEach(function(a,c){j[c]||(j[c]=[]),a.forEach(function(a){j[c]=j[c].concat(ITS.getTriplesMatching(new Triple(b,a,void 0)))})}),g.forEach(function(b){j.forEach(function(c,g){b.forEach(function(b){c.forEach(function(c){var j=null;f?(a.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(+b.o,+c.o).transform(i[g],e.getProjectionObject()),d)),f=!1):a.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(+b.o,+c.o).transform(i[g],e.getProjectionObject()),d.clone())),j=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(+b.o,+c.o).transform(i[g],e.getProjectionObject())),j.attributes={rdflabeltext:k.join("	/	"),favColor:"rgba(	255,	255,	255,	0.95	)",align:"ct",xOffset:0,yOffset:-12},h.addFeatures(new Array(j))})})})})})}}),f||e.zoomToExtent(a.getDataExtent())}(),$("#mapitem"+nextmapid).draggable({containment:"parent",opacity:.5,cancel:".selectable"}),nextmapid+=1,msnry.layout(),displayPageLoaded()}function testbuttonT(){displayPageLoading();var a=[],b=null,c=null,d=null,e="",f=0,g=new Mapping,h=new Mapping;b=$('<div	class="item	timeline"	id="timelineitem'+nexttimelineid+'"><button	onclick="removeitem(\'timelineitem'+nexttimelineid+"')\">X</button><button	onclick=\"nodetogglecontent(this,'timelineitem"+nexttimelineid+'\')">-</button>Visualisation:	timeline	|	<span	class="timestamp">'+(new Date).toLocaleDateString()+"&nbsp;"+(new Date).toLocaleTimeString()+'</span><div	class="canevas	hideable	timelineContainer"	id="timeline'+nexttimelineid+'"></div></div>'),c=b[0],d=document.createDocumentFragment(),d.appendChild(c),webappfullcontainer.insertBefore(d,webappfullcontainer.firstChild),a.push(c),msnry.prepended(a),suggestionsFor.forEach(function(a,b){if(a.hasValue("timeline")){var c=new Mapping,d=[];objectid_to_uri[b].forEach(function(a){ITS.getTriplesMatching(new Triple(a,"http://www.w3.org/2000/01/rdf-schema#label",void 0)).forEach(function(a){d.hasValue(a.o)||d.push(a.o)})}),objectid_to_uri[b].forEach(function(a){knownPredicates.date.forEach(function(b,d){c[d]||(c[d]=[]),b.forEach(function(b){b.forEach(function(b){c[d]=c[d].concat(ITS.getTriplesMatching(new Triple(a,b,void 0)))})})})}),c.forEach(function(a,b){a.forEach(function(a){var c=parseDate(a.o,b),d=c.fullyear,e=c.fullmonth,f=c.fullday,h=c.fullhour,i=c.fullminute,j=c.fullsecond;g[d]||(g[d]=new Mapping),g[d][e]||(g[d][e]=new Mapping),g[d][e][f]||(g[d][e][f]=new Mapping),g[d][e][f][h]||(g[d][e][f][h]=new Mapping),g[d][e][f][h][i]||(g[d][e][f][h][i]=new Mapping),g[d][e][f][h][i][j]||(g[d][e][f][h][i][j]=[]),g[d][e][f][h][i][j].push(a)})}),h[b]=d.join("	/	")}}),e+='<div	class="timelineMajor">',g.forEach(function(a,b){a.forEach(function(a,c){a.forEach(function(a,d){a.forEach(function(a,e){a.forEach(function(a,f){g[b][c][d][e][f].sortKeys()}),g[b][c][d][e].sortKeys()}),g[b][c][d].sortKeys()}),g[b][c].sortKeys()}),g[b].sortKeys()}),g.sortKeys(),g.forEach(function(a,b){e+='<h2	class="timelineMajorMarker	selectable">'+b+"</h2>",a.forEach(function(a,b){e+='<h3	class="timelineMajorMarker	selectable">'+parseDate(b,"M").fullmonthtext+"</h3>",a.forEach(function(a,b){e+='<h4	class="timelineMajorMarker	selectable">'+b+"</h4>",a.forEach(function(a){a.forEach(function(a){a.forEach(function(a){a.forEach(function(a){e+='<dl	class="timelineMinor"><h3	class="selectable">'+a.o+'</h3><dt	id="timelineEventTitle'+f+'"><h4	class="selectable">'+h[objectid_to_uri.getKeyOfOneContainerOf(a.s)]+'</h4></dt><dd	class="timelineEvent"	id="timelineEventTitle'+f+'EX"><p	class="selectable	uri">'+a.p+"</p></dd></dl>",f+=1})})})})})})}),e+="</div>",$(e).hide().appendTo("#timeline"+nexttimelineid).fadeIn(),$("#timelineitem"+nexttimelineid).draggable({containment:"parent",opacity:.5,cancel:".selectable"}),nexttimelineid+=1,msnry.layout(),displayPageLoaded()}Object.keys||(Object.keys=function(){"use	strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys	called	on	non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),Array.prototype.forEach||(Array.prototype.forEach=function(a){"use	strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;c>e;e++)e in b&&a.call(d,b[e],e,b)}),Array.prototype.some||(Array.prototype.some=function(a){"use	strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;c>e;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),Array.prototype.every||(Array.prototype.every=function(a){"use	strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;c>e;e++)if(e in b&&!a.call(d,b[e],e,b))return!1;return!0}),Array.prototype.hasValue||(Array.prototype.hasValue=function(a){"use	strict";if(void 0===this||null===this)throw new TypeError;for(var b=Object(this),c=b.length>>>0,d=0;c>d;d++)if(d in b&&b[d]==a)return!0;return!1});var url_data={GET:function(a,b){var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(window.location.href);return null==d?b||null:d[1]}},webappfullcontainer=document.querySelector("#webappfullcontent"),msnry=new Masonry(webappfullcontainer,{columnWidth:10,itemSelector:".item",isAnimated:!0,animationOptions:{duration:1e3,easing:"linear",queue:!1}}),Triple=function(a,b,c){this.s=a||void 0,this.p=b||void 0,this.o=c||void 0};Triple.prototype.toString=function(){if(void 0===this||null===this)throw new TypeError;return"( "+this.s+", "+this.p+", "+this.o+" )"};var Mapping=function(){};Mapping.prototype.forEach=function(a){if(void 0===this||null===this||"function"!=typeof a)throw new TypeError;var b=Object(this),c=arguments.length>=2?arguments[1]:void 0,d=void 0;for(d in b)b.hasOwnProperty(d)&&a.call(c,b[d],d,b)},Mapping.prototype.count=function(){if(void 0===this||null===this)throw new TypeError;return Object.keys(this).length},Mapping.prototype.hasKey=function(a){if(void 0===this||null===this)throw new TypeError;return this.hasOwnProperty(a)},Mapping.prototype.hasValue=function(a){if(void 0===this||null===this)throw new TypeError;var b=void 0;for(b in this)if(this.hasOwnProperty(b)&&this[b]==a)return!0;return!1},Mapping.prototype.getKeyOfOneContainerOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=void 0;for(b in this)if(this.hasOwnProperty(b)&&this[b].hasValue(a))return b;return void 0},Mapping.prototype.getCloneWithSortedKeys=function(){if(void 0===this||null===this)throw new TypeError;var a=this,b=void 0,c=[],d=new Mapping;for(b in this)this.hasOwnProperty(b)&&c.push(b);return c.sort(function(a,b){return b>a?-1:a>b?1:0}),c.forEach(function(b){d[b]=a[b]}),d},Mapping.prototype.sortKeys=function(){if(void 0===this||null===this)throw new TypeError;var a=this,b=void 0,c=[],d=new Mapping;for(b in this)this.hasOwnProperty(b)&&c.push(b);c.sort(function(a,b){return b>a?-1:a>b?1:0}),c.forEach(function(b){d[b]=a[b],delete a[b],a[b]=d[b]})},Mapping.prototype.toString=function(){if(void 0===this||null===this)throw new TypeError;var a="{\n",b=0;return this.forEach(function(c,d){b+=1,a+="	",b>1&&b<this.count()&&(a+=",\n"),a+=d+"	:	"+c}),a+="\n}"};var InternalTripleStore=function(){function a(a,b,c,d){var e=!1;try{a.hasKey(b)||(a[b]=new Mapping),a[b].hasKey(c)||(a[b][c]=[]),a[b][c].hasValue(d)||a[b][c].push(d),e=!0}catch(f){e=!1}finally{return h(e)}}function b(a,b,c,d){var e=!1;try{var f=a[b][c].indexOf(d);e=f>-1,e&&a[b][c].splice(f,1),a[b][c].length<1&&(delete a[b][c],e=!0),a[b].count()<1&&(delete a[b],e=!0)}catch(g){e=!1}finally{return h(e)}}this.constructor.nbInstance+=1;var c=new Mapping,d=new Mapping,e=new Mapping,f=0,g=0,h=function(a){return g+=1,a&&(f+=1),a};this.getTriplesMatching=function(a){var b=[];try{a.s?a.p?a.o?c[a.s][a.p].hasValue(a.o)&&b.push(new Triple(a.s,a.p,a.o)):c[a.s][a.p].forEach(function(c){b.push(new Triple(a.s,a.p,c))
}):a.o?e[a.o][a.s].forEach(function(c){b.push(new Triple(a.s,c,a.o))}):c[a.s].forEach(function(c,d){c.forEach(function(c){b.push(new Triple(a.s,d,c))})}):a.p?a.o?d[a.p][a.o].forEach(function(c){b.push(new Triple(c,a.p,a.o))}):d[a.p].forEach(function(c,d){c.forEach(function(c){b.push(new Triple(c,a.p,d))})}):a.o?e[a.o].forEach(function(c,d){c.forEach(function(c){b.push(new Triple(d,c,a.o))})}):c.forEach(function(a,c){a.forEach(function(a,d){a.forEach(function(a){b.push(new Triple(c,d,a))})})})}catch(f){}finally{return b}},this.getAllTriples=function(){var a=[];return c.forEach(function(b,c){b.forEach(function(b,d){b.forEach(function(b){a.push(new Triple(c,d,b))})})}),a},this.countTriplesMatching=function(a){var b=0;try{a.s?a.p?a.o?c[a.s][a.p].hasValue(a.o)&&(b+=1):c[a.s][a.p].forEach(function(){b+=1}):a.o?e[a.o][a.s].forEach(function(){b+=1}):c[a.s].forEach(function(a){a.forEach(function(){b+=1})}):a.p?a.o?d[a.p][a.o].forEach(function(){b+=1}):d[a.p].forEach(function(a){a.forEach(function(){b+=1})}):a.o?e[a.o][a.s].forEach(function(){b+=1}):c.forEach(function(a){a.forEach(function(a){a.forEach(function(){b+=1})})})}catch(f){b=-1}finally{return b}},this.addTriple=function(b){return a(c,b.s,b.p,b.o)&&a(d,b.p,b.o,b.s)&&a(e,b.o,b.s,b.p)},this.removeTriple=function(a){var f=[];return this.getTriplesMatching(a).forEach(function(a){b(c,a.s,a.p,a.o)&&b(d,a.p,a.o,a.s)&&b(e,a.o,a.s,a.p)||f.push(a)}),f}};InternalTripleStore.nbInstance=0;var knownPredicates=new Mapping,suggestionsFor=new Mapping;knownPredicates.label=new Mapping,knownPredicates.date=new Mapping,knownPredicates.date.YMD=new Mapping,knownPredicates.date.YMD.iso8601=[],knownPredicates.date.YMD["xsd:date"]=["http://dbpedia.org/ontology/birthDate"],knownPredicates.date.YMDHIS=new Mapping,knownPredicates.date.YMDHIS["xsd:date"]=[],knownPredicates.number=new Mapping,knownPredicates.geo=new Mapping,knownPredicates.geo.longitude=new Mapping,knownPredicates.geo.longitude.wgs84=["http://www.w3.org/2003/01/geo/wgs84_pos#long"],knownPredicates.geo.latitude=new Mapping,knownPredicates.geo.latitude.wgs84=["http://www.w3.org/2003/01/geo/wgs84_pos#lat"];var hashtagworkspaceid="#webappfullcontent",defaultsparqltimeout=6e4,sparqlendpoint=["http://dbpedia.org/sparql"],actionhistory=[],actionhistory_pointer=0,objectids=[],nextobjectid=0,nextmapid=0,nexttimelineid=0,nextsuggestionseditorid=0,objectid_to_uri=new Mapping,object_has_expanded_predicates=new Mapping,img_loading_dark_32='<img	src="img/loading_in_the_dark_002.gif"	alt="Chargement…"	title="Loading…"	width="24px"	height="24px"	/>',img_valid_32='<img	src="img/valid.png"	alt="Valide"	title="Ok"	width="24px"	height="24px"	/>',img_wrong_32='<img	src="img/wrong.png"	alt="Erreur"	title="Wrong"	width="24px"	height="24px"	/>',img_images_32='<img	src="img/loadbar001.gif"	alt="Images…"	title="Images…"	width="24px"	height="24px"	/>',ITS=new InternalTripleStore;window.location.href.indexOf("?")>-1?rebuildsafeworkspacewithdata():rebuilddefaultworkspace(),$(hashtagworkspaceid).resizable({handles:"s",grid:[64,64],autoHide:!0,ghost:!0,animate:!0,minHeight:256,cancel:".selectable"}),$("#defaultendpoint").keyup(function(a){13==a.keyCode&&(a.preventDefault(),startbrowsing_click())}),$("#defaultentryuri").keyup(function(a){13==a.keyCode&&(a.preventDefault(),startbrowsing_click())});